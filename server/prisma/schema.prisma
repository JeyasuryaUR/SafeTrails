// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  password     String
  firstName    String?
  lastName     String?
  username     String?  @unique
  phone        String?
  
  // KYC Details
  dateOfBirth  DateTime?
  aadhaarNumber String?  @unique
  digitalId    String?  @unique
  safetyScore  Float?   @default(0.0)
  
  // Current Location Tracking
  currentLatitude  Float?
  currentLongitude Float?
  lastLocationUpdate DateTime?
  
  // Emergency Contacts
  emergencyNumbers Json?  // Array of emergency contact numbers
  
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relationships
  trips        Trip[]
  communityPosts CommunityPost[]
  sosRequests  SosRequest[]

  @@map("users")
}

model Trip {
  id          String   @id @default(cuid())
  userId      String
  startDate   DateTime
  endDate     DateTime
  location    String
  score       Float?   @default(0.0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  itineraryItems ItineraryItem[]
  communityPosts CommunityPost[]

  @@map("trips")
}

model ItineraryItem {
  id          String   @id @default(cuid())
  tripId      String
  location    String
  landmark    String?
  latitude    Float
  longitude   Float
  safetyScore Float?   @default(0.0)
  order       Int      // Order of the item in the itinerary
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  trip        Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@map("itinerary_items")
}

model CommunityPost {
  id              String   @id @default(cuid())
  userId          String
  tripId          String?  // Optional trip association
  imageUrl        String?
  issueDescription String
  location        String
  likeCount       Int      @default(0)
  dislikeCount    Int      @default(0)
  priority        Priority @default(MEDIUM)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relationships
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  trip            Trip?    @relation(fields: [tripId], references: [id], onDelete: SetNull)

  @@map("community_posts")
}

model SosRequest {
  id          String    @id @default(cuid())
  userId      String
  location    String
  latitude    Float
  longitude   Float
  state       SosState  @default(NEW)
  comment     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relationships
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sos_requests")
}

model Admin { 
  id          String   @id @default(cuid())
  email        String   @unique
  password     String

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("admins")
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum SosState {
  NEW
  RESOLVED
}
